<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Djamal TOE">
<meta name="dcterms.date" content="2025-06-23">

<title>DJAMAL WEBSITE - Détection d’anomalies dans les transactions banquaires</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="index.qmd" class="navbar-brand navbar-brand-logo">
    <img src="../images/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="index.qmd">
    <span class="navbar-title">DJAMAL WEBSITE</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-statistics--machine-learning" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Statistics &amp; Machine Learning</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-statistics--machine-learning">    
        <li>
    <a class="dropdown-item" href="../INFO_MINI_PROJETS/classi_bin_acp_kmeans_knn_logit/Breast-Tumor-Article.html" rel="" target="">
 <span class="dropdown-text">Diagnostic assisté par ACP et régression logistique</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../INFO_MINI_PROJETS/brain-tumor-classification-effcientnet.html" rel="" target="">
 <span class="dropdown-text">Diagnostic tumeurs cérébrales - Reseau de neurones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../ANALYSES_FACTORIELLES/acp-kmeans.html" rel="" target="">
 <span class="dropdown-text">Reduction de dimensionnalité et clustering non supervisé</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../FORMATIONS/logistic_regression_diabetes.html" rel="" target="">
 <span class="dropdown-text">Modélisation des données à variables dépendantes binaires</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../projet-traitement-donnees/report_writing/synthese-des-travaux.html" rel="" target="">
 <span class="dropdown-text">Prédire la durée de carrière des joueurs NBA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../INFO_MINI_PROJETS/anomaly-detection-in-transactions-GMM.html" rel="" target="">
 <span class="dropdown-text">Détection d’anomalies dans les transactions à l’aide de modèles de mélange gaussien</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../FORMATIONS/poisson_paludisme.html" rel="" target="">
 <span class="dropdown-text">Modélisation des données de comptage</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../INFO_MINI_PROJETS/shifumi-cnn-yolov8.html" rel="" target="">
 <span class="dropdown-text">Classification des gestes de la main avec Yolo et CNN</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-programming" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Programming</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-programming">    
        <li>
    <a class="dropdown-item" href="../INFO_MINI_PROJETS/assistant_virtuel.html" rel="" target="">
 <span class="dropdown-text">Crée ton assistant virtuel avec pyhton</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../INFO_MINI_PROJETS/JavaApp/desktop-app-java-mysql.html" rel="" target="">
 <span class="dropdown-text">Application desktop avec Java et Mysql</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-various" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Various</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-various">    
        <li>
    <a class="dropdown-item" href="../FORMATIONS/machine-learning/gradient-descent-linear-reg.html" rel="" target="">
 <span class="dropdown-text">Régression linéaire par descente de gradient - théorie et application</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../publications.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html" rel="" target="">
 <span class="menu-text">About me</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://www.linkedin.com/in/djamal-toe-7a18432b0" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text">LinkedIn</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/Djamal029" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text">Github</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#méthodologie" id="toc-méthodologie" class="nav-link" data-scroll-target="#méthodologie">Méthodologie</a></li>
  <li><a href="#pratique" id="toc-pratique" class="nav-link" data-scroll-target="#pratique">Pratique</a>
  <ul class="collapse">
  <li><a href="#log-vraisemblance-complète-dans-un-gmm" id="toc-log-vraisemblance-complète-dans-un-gmm" class="nav-link" data-scroll-target="#log-vraisemblance-complète-dans-un-gmm">Log-vraisemblance complète dans un GMM</a></li>
  </ul></li>
  <li><a href="#analyse-du-pairplot-des-anomalies-gmm" id="toc-analyse-du-pairplot-des-anomalies-gmm" class="nav-link" data-scroll-target="#analyse-du-pairplot-des-anomalies-gmm">📊 Analyse du Pairplot des Anomalies (GMM)</a>
  <ul class="collapse">
  <li><a href="#variables-analysées" id="toc-variables-analysées" class="nav-link" data-scroll-target="#variables-analysées">🎯 Variables analysées</a></li>
  <li><a href="#lecture-du-graphique" id="toc-lecture-du-graphique" class="nav-link" data-scroll-target="#lecture-du-graphique">Lecture du graphique</a></li>
  <li><a href="#interprétation-variable-par-variable" id="toc-interprétation-variable-par-variable" class="nav-link" data-scroll-target="#interprétation-variable-par-variable">Interprétation variable par variable</a></li>
  <li><a href="#interactions-clés-entre-variables" id="toc-interactions-clés-entre-variables" class="nav-link" data-scroll-target="#interactions-clés-entre-variables">Interactions clés entre variables</a></li>
  <li><a href="#cas-particulier-visible-dans-le-coin-bas-gauche" id="toc-cas-particulier-visible-dans-le-coin-bas-gauche" class="nav-link" data-scroll-target="#cas-particulier-visible-dans-le-coin-bas-gauche">Cas particulier visible dans le coin bas-gauche</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#annexes" id="toc-annexes" class="nav-link" data-scroll-target="#annexes">Annexes</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Détection d’anomalies dans les transactions banquaires</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Djamal TOE </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 23, 2025</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;La détection de fraudes sur les transactions bancaires est un enjeu majeur pour les institutions financières. Les méthodes traditionnelles basées sur des règles statiques peinent à s’adapter aux schémas de fraude de plus en plus sophistiqués. Dès 2002, Bolton &amp; Hand ont proposé un modèle statistique pour identifier les anomalies transactionnelles <span class="citation" data-cites="Bolton2002">(<a href="#ref-Bolton2002" role="doc-biblioref">Bolton and Hand 2002</a>)</span>. Depuis, de nombreuses approches ont émergé, à la fois supervisées et non supervisées, offrant des performances variables selon la disponibilité de données étiquetées, la diversité des comportements normaux et la capacité à détecter de nouvelles formes de fraude <span class="citation" data-cites="Phua2010 Ngai2011 Chalapathy2019">(<a href="#ref-Phua2010" role="doc-biblioref">Phua et al. 2010</a>; <a href="#ref-Ngai2011" role="doc-biblioref">Ngai et al. 2011</a>; <a href="#ref-Chalapathy2019" role="doc-biblioref">Chalapathy and Chawla 2019</a>)</span>.</p>
<blockquote class="blockquote">
<p><strong>Note</strong><br>
Le notebook ainsi que toutes ses dépendances sont disponibles sur GitHub :<br>
<a href="https://github.com/Djamal029/ANOMALY_DETECTION_GMM">Cliquez ici pour cccéder au dépôt</a></p>
</blockquote>
</section>
<section id="méthodologie" class="level2">
<h2 class="anchored" data-anchor-id="méthodologie">Méthodologie</h2>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Pour ce mini-projet, nous adopterons une approche non supervisée utilisant un Gaussian Mixture Model (<code>GMM</code>). Le <code>GMM</code> permet de modéliser la distribution sous-jacente des transactions légitimes par une combinaison de gaussiennes, et d’identifier les observations présentant une faible vraisemblance comme anomalies <span class="citation" data-cites="Bishop2006">(<a href="#ref-Bishop2006" role="doc-biblioref">Bishop 2006</a>)</span>.</p>
<p>Les étapes principales sont:</p>
<ul>
<li><p><strong>Prétraitement des données</strong>:</p>
<ul>
<li><p>Sélection des variables pertinentes (montant, temporalité, etc.);</p></li>
<li><p>Nettoyage, transformation et mise à l’échelle <span class="citation" data-cites="Hastie2009">(<a href="#ref-Hastie2009" role="doc-biblioref">Hastie, Tibshirani, and Friedman 2009</a>)</span></p></li>
</ul></li>
<li><p><strong>Estimation du GMM</strong>:</p>
<ul>
<li><p>Choix du nombre de composantes par critères AIC/BIC <span class="citation" data-cites="Schwarz1978">(<a href="#ref-Schwarz1978" role="doc-biblioref">Schwarz 1978</a>)</span></p></li>
<li><p>Ajustement du modèle sur les données normalisées</p></li>
</ul></li>
<li><p><strong>Détection des anomalies</strong>:</p>
<ul>
<li><p>Calcul de la log-vraisemblance pour chaque transaction</p></li>
<li><p>Définition d’un seuil basé sur un percentile (par exemple 1%) pour isoler les transactions suspectes <span class="citation" data-cites="Ngai2011">(<a href="#ref-Ngai2011" role="doc-biblioref">Ngai et al. 2011</a>)</span></p></li>
</ul></li>
</ul>
</section>
<section id="pratique" class="level2">
<h2 class="anchored" data-anchor-id="pratique">Pratique</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   Unnamed: 0 TransactionID  ... AccountBalance  PreviousTransactionDate
0           0      TX000001  ...        5112.21      2024-11-04 08:08:08
1           1      TX000002  ...       13758.91      2024-11-04 08:09:35
2           2      TX000003  ...        1122.35      2024-11-04 08:07:04
3           3      TX000004  ...        8569.06      2024-11-04 08:09:06
4           4      TX000005  ...        7429.40      2024-11-04 08:06:39

[5 rows x 17 columns]</code></pre>
</div>
</div>
<p><strong>About Dataset</strong> (From kaggle (<a href="https://www.kaggle.com/datasets/valakhorasani/bank-transaction-dataset-for-fraud-detection">link</a>))</p>
<p><span class="math inline">\(\quad\)</span> This dataset provides a detailed look into transactional behavior and financial activity patterns, ideal for exploring fraud detection and anomaly identification. It contains 2,512 samples of transaction data, covering various transaction attributes, customer demographics, and usage patterns. Each entry offers comprehensive insights into transaction behavior, enabling analysis for financial security and fraud detection applications.</p>
<p><strong>Key Features:</strong></p>
<ul>
<li><p><code>TransactionID</code>: Unique alphanumeric identifier for each transaction.</p></li>
<li><p><code>AccountID</code>: Unique identifier for each account, with multiple transactions per account.</p></li>
<li><p><code>TransactionAmount</code>: Monetary value of each transaction, ranging from small everyday expenses to larger purchases.</p></li>
<li><p><code>TransactionDate</code>: Timestamp of each transaction, capturing date and time.</p></li>
<li><p><code>TransactionType</code>: Categorical field indicating ‘Credit’ or ‘Debit’ transactions.</p></li>
<li><p><code>Location</code>: Geographic location of the transaction, represented by U.S. city names.</p></li>
<li><p><code>DeviceID</code>: Alphanumeric identifier for devices used to perform the transaction.</p></li>
<li><p><code>IP Address</code>: IPv4 address associated with the transaction, with occasional changes for some accounts.</p></li>
<li><p><code>MerchantID</code>: Unique identifier for merchants, showing preferred and outlier merchants for each account.</p></li>
<li><p><code>AccountBalance</code>: Balance in the account post-transaction, with logical correlations based on transaction type and amount.</p></li>
<li><p><code>PreviousTransactionDate</code>: Timestamp of the last transaction for the account, aiding in calculating transaction frequency.</p></li>
<li><p><code>Channel</code>: Channel through which the transaction was performed (e.g., Online, ATM, Branch).</p></li>
<li><p><code>CustomerAge</code>: Age of the account holder, with logical groupings based on occupation.</p></li>
<li><p><code>CustomerOccupation</code>: Occupation of the account holder (e.g., Doctor, Engineer, Student, Retired), reflecting income patterns.</p></li>
<li><p><code>TransactionDuration</code>: Duration of the transaction in seconds, varying by transaction type.</p></li>
<li><p><code>LoginAttempts</code>: Number of login attempts before the transaction, with higher values indicating potential anomalies.</p></li>
</ul>
<p>This dataset is ideal for data scientists, financial analysts, and researchers looking to analyze transactional patterns, detect fraud, and build predictive models for financial security applications. The dataset was designed for machine learning and pattern analysis tasks and is not intended as a primary data source for academic publications.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 2512 entries, 0 to 2511
Data columns (total 17 columns):
 #   Column                   Non-Null Count  Dtype  
---  ------                   --------------  -----  
 0   Unnamed: 0               2512 non-null   int64  
 1   TransactionID            2512 non-null   object 
 2   AccountID                2512 non-null   object 
 3   TransactionAmount        2512 non-null   float64
 4   TransactionDate          2512 non-null   object 
 5   TransactionType          2512 non-null   object 
 6   Location                 2512 non-null   object 
 7   DeviceID                 2512 non-null   object 
 8   IP Address               2512 non-null   object 
 9   MerchantID               2512 non-null   object 
 10  Channel                  2512 non-null   object 
 11  CustomerAge              2512 non-null   int64  
 12  CustomerOccupation       2512 non-null   object 
 13  TransactionDuration      2512 non-null   int64  
 14  LoginAttempts            2512 non-null   int64  
 15  AccountBalance           2512 non-null   float64
 16  PreviousTransactionDate  2512 non-null   object 
dtypes: float64(2), int64(4), object(11)
memory usage: 333.8+ KB</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Unnamed: 0                 0
TransactionID              0
AccountID                  0
TransactionAmount          0
TransactionDate            0
TransactionType            0
Location                   0
DeviceID                   0
IP Address                 0
MerchantID                 0
Channel                    0
CustomerAge                0
CustomerOccupation         0
TransactionDuration        0
LoginAttempts              0
AccountBalance             0
PreviousTransactionDate    0
dtype: int64</code></pre>
</div>
</div>
<p><span class="math inline">\(\quad\)</span> Certaines variables, bien que nettoyées et sans valeurs manquantes, n’ont pas été exploitées dans l’analyse principale&nbsp;:<br>
- <strong>TransactionID</strong><br>
- <strong>AccountID</strong><br>
- <strong>DeviceID</strong><br>
- <strong>IP Address</strong><br>
- <strong>MerchantID</strong></p>
<p>Toutefois, selon l’objectif visé, certaines d’entre elles pourraient s’avérer très pertinentes:<br>
- <strong>AccountID</strong>: détection de comptes à risque, suivi des comportements de chaque titulaire,<br>
- <strong>IP Address</strong>: analyse spatiale et traçage géographique des connexions,<br>
- <strong>MerchantID</strong>: étude du comportement des commerçants et détection d’anomalies spécifiques à certains points de vente.</p>
<p>Pour des raisons éthiques, ces détails ne seront pas explorées dans le cadre de cet <strong>mini-projet</strong>, car nous ne savons pas si les ID sont réels ou pas.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   TransactionAmount  ... PreviousTransactionDate
0              14.09  ...     2024-11-04 08:08:08
1             376.24  ...     2024-11-04 08:09:35
2             126.29  ...     2024-11-04 08:07:04
3             184.50  ...     2024-11-04 08:09:06
4              13.45  ...     2024-11-04 08:06:39

[5 rows x 11 columns]</code></pre>
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Les variables <code>TransactionDate</code> et <code>PreviousTransactionDate</code> peuvent nous servir à calculer une variables plus informative et utilisable qui est <code>TimeBetweenThisTransactionAndTheLastOne</code> qui pourrait être en heures ou en secondes en fonction des valeurs obtenues de la différence entre ces deux dates.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   TransactionAmount  ... TimeBetweenThisTransactionAndTheLastOne
0              14.09  ...                                13743.65
1             376.24  ...                                11895.42
2             126.29  ...                                11581.85
3             184.50  ...                                13167.62
4              13.45  ...                                 9230.25

[5 rows x 10 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>count     2512.000000
mean     11699.619928
std       2553.112387
min       7381.750000
25%       9469.435000
50%      11654.350000
75%      13935.792500
max      16120.190000
Name: TimeBetweenThisTransactionAndTheLastOne, dtype: float64</code></pre>
</div>
</div>
<p>On pourrait même convertir cela en nombre de jours car le minimum est de <code>7381.75</code> heures.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   TransactionAmount  ... DaysBetweenThisTransactionAndTheLastOne
0              14.09  ...                                   573.0
1             376.24  ...                                   496.0
2             126.29  ...                                   483.0
3             184.50  ...                                   549.0
4              13.45  ...                                   385.0

[5 rows x 10 columns]</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>count    2512.000000
mean      487.857882
std       106.378910
min       308.000000
25%       395.000000
50%       486.000000
75%       581.000000
max       672.000000
Name: DaysBetweenThisTransactionAndTheLastOne, dtype: float64</code></pre>
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Il est apparaît surprenant que qu’il y’ai autant de jour entre deux transaction. Nous n’avons pas fait d’erreur de calcul car si vous monter un peu plus haut et en regardant les colonnes <code>TransactionDate</code> and <code>PreviousTransactionDate</code> vous verrez que cet écart peut s’expliquer par diverses raisons sauf par une erreur de calcul de notre part.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>var_list <span class="op">=</span> <span class="bu">list</span>(df_reduced.columns.values)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>figsize <span class="op">=</span> (<span class="dv">12</span>, <span class="dv">8</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>n_vars <span class="op">=</span> <span class="bu">len</span>(var_list)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calcul automatique du nombre de colonnes si non fourni</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>ncols <span class="op">=</span> <span class="bu">int</span>(math.ceil(math.sqrt(n_vars)))</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>nrows <span class="op">=</span> <span class="bu">int</span>(math.ceil(n_vars <span class="op">/</span> ncols))</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(nrows<span class="op">=</span>nrows, ncols<span class="op">=</span>ncols, figsize<span class="op">=</span>figsize)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>axes <span class="op">=</span> axes.flatten() </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(hspace<span class="op">=</span><span class="fl">0.4</span>, wspace<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>bins_ <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(var_list)):</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    var_name <span class="op">=</span> var_list[i]</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df_reduced[var_name].dtype <span class="kw">in</span> [<span class="st">'categorical'</span>, <span class="st">'object'</span>]:</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>        plot_bar(df<span class="op">=</span>df_reduced, var_name<span class="op">=</span>var_name, ax<span class="op">=</span>axes[i])</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        plot_hist(df<span class="op">=</span>df_reduced, var_name<span class="op">=</span>var_name, ax<span class="op">=</span>axes[i])</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(var_list), <span class="bu">len</span>(axes)):</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    axes[j].set_visible(<span class="va">False</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.suptitle('Variables distribution')</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-var-dist" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="dist-var.png" style="width:95.0%;height:90.0%" class="figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Selecting the optimum number of components</figcaption>
</figure>
</div>
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On arrive à voir que nous avons énormément de zones ou regions de transactions. On peut aussi constater que le nombre de tentatives de connexion est discret avec des valeurs faibles (à prendre en compte dans la modélisation future).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Location
Fort Worth          70
Los Angeles         69
Oklahoma City       68
Charlotte           68
Tucson              67
Philadelphia        67
Omaha               65
Miami               64
Detroit             63
Houston             63
Memphis             63
Denver              62
Kansas City         61
Boston              61
Mesa                61
Atlanta             61
Seattle             61
Colorado Springs    60
Jacksonville        60
Fresno              60
Chicago             60
Austin              59
San Jose            59
Raleigh             59
San Antonio         59
San Diego           59
Indianapolis        58
New York            58
San Francisco       57
Nashville           55
Milwaukee           55
Las Vegas           55
Virginia Beach      55
Phoenix             55
Columbus            54
Sacramento          53
Baltimore           51
Louisville          51
Dallas              49
Washington          48
El Paso             46
Portland            42
Albuquerque         41
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Imaginons que nous n’ayons que des données continues pour detecter les anomalies. Appliquons un modèle de mélange gaussien.</p>
<section id="log-vraisemblance-complète-dans-un-gmm" class="level3">
<h3 class="anchored" data-anchor-id="log-vraisemblance-complète-dans-un-gmm">Log-vraisemblance complète dans un GMM</h3>
<p>Soit :</p>
<ul>
<li><p><span class="math inline">\(X = \{x_1, \ldots, x_n\}\)</span> : les données observées,</p></li>
<li><p><span class="math inline">\(Z = \{z_1, \ldots, z_n\}\)</span> : les variables latentes (composantes d’appartenance),</p></li>
<li><p><span class="math inline">\(\Theta = \{ \pi_k, \mu_k, \Sigma_k \}_{k=1}^K\)</span> : les paramètres du modèle,</p></li>
<li><p><span class="math inline">\(z_{ik} = 1\)</span> si <span class="math inline">\(x_i\)</span> appartient à la composante <span class="math inline">\(k\)</span>, sinon <span class="math inline">\(0\)</span>.</p></li>
<li><p><strong>Vraisemblance complète</strong></p></li>
</ul>
<p>On suppose que l’observation <span class="math inline">\(x_i\)</span> vient de la composante <span class="math inline">\(k\)</span> avec une probabilité <span class="math inline">\(\pi_k\)</span>, et que la distribution conditionnelle est gaussienne :</p>
<p><span class="math display">\[
p(X, Z \mid \Theta) = \prod_{i=1}^n \prod_{k=1}^K \left[ \pi_k \, \mathcal{N}(x_i \mid \mu_k, \Sigma_k) \right]^{z_{ik}}
\]</span></p>
<ul>
<li><strong>Log-vraisemblance augmentée</strong></li>
</ul>
<p>En prenant le logarithme, on obtient la log-vraisemblance augmentée :</p>
<p><span class="math display">\[
\log p(X, Z \mid \Theta) = \sum_{i=1}^n \sum_{k=1}^K z_{ik} \left( \log \pi_k + \log \mathcal{N}(x_i \mid \mu_k, \Sigma_k) \right)
\]</span></p>
<ul>
<li>L’algorithme EM maximise l’espérance de cette quantité (appelée <strong>Q-fonction</strong>) dans l’étape E :</li>
</ul>
<p><span class="math display">\[
Q(\Theta \mid \Theta^{\text{old}}) = \mathbb{E}_{Z \mid X, \Theta^{\text{old}}} [ \log p(X, Z \mid \Theta) ]
\]</span></p>
<ul>
<li><strong>Algorithme EM pour un modèle de mélange gaussien (GMM)</strong></li>
</ul>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Soit un jeu de données <span class="math inline">\(X = \{ x_1, x_2, \ldots, x_n \}\)</span> avec <span class="math inline">\(n\)</span> observations, et un GMM avec <span class="math inline">\(K\)</span> composantes. En vous épargnant de la résolution du problème : <span class="math inline">\(\Theta = argmax \log p(X, Z \mid \Theta)\)</span></p>
<ul>
<li><strong>Initialisation</strong></li>
</ul>
<p>Initialiser les paramètres du modèle pour chaque composante <span class="math inline">\(k = 1, \ldots, K\)</span> :</p>
<ul>
<li><p>Les poids : <span class="math inline">\(\pi_k\)</span>, avec <span class="math inline">\(\sum_{k=1}^K \pi_k = 1\)</span> et <span class="math inline">\(\pi_k &gt; 0\)</span>,</p></li>
<li><p>Les moyennes : <span class="math inline">\(\mu_k \in \mathbb{R}^d\)</span>,</p></li>
<li><p>Les matrices de covariance : <span class="math inline">\(\Sigma_k \in \mathbb{R}^{d \times d}\)</span>.</p></li>
<li><p><strong>Étape 1 : Expectation (E-step)</strong></p></li>
</ul>
<p>Pour chaque observation <span class="math inline">\(x_i\)</span>, calculer la responsabilité <span class="math inline">\(\gamma_{ik}\)</span> qui est la probabilité que <span class="math inline">\(x_i\)</span> appartienne à la composante <span class="math inline">\(k\)</span>, donnée les paramètres actuels :</p>
<p><span class="math display">\[
\gamma_{ik} = \frac{\pi_k \, \mathcal{N}(x_i \mid \mu_k, \Sigma_k)}{\sum_{j=1}^K \pi_j \, \mathcal{N}(x_i \mid \mu_j, \Sigma_j)}
\]</span></p>
<p>où <span class="math inline">\(\mathcal{N}(x \mid \mu, \Sigma)\)</span> est la densité de la loi normale multivariée.</p>
<ul>
<li><strong>Étape 2 : Maximisation (M-step)</strong></li>
</ul>
<p>Mettre à jour les paramètres <span class="math inline">\(\pi_k\)</span>, <span class="math inline">\(\mu_k\)</span>, <span class="math inline">\(\Sigma_k\)</span> en fonction des responsabilités calculées :</p>
<ul>
<li>Mise à jour des poids :</li>
</ul>
<p><span class="math display">\[
\pi_k = \frac{1}{n} \sum_{i=1}^n \gamma_{ik}
\]</span></p>
<ul>
<li>Mise à jour des moyennes :</li>
</ul>
<p><span class="math display">\[
\mu_k = \frac{\sum_{i=1}^n \gamma_{ik} x_i}{\sum_{i=1}^n \gamma_{ik}}
\]</span></p>
<ul>
<li>Mise à jour des covariances :</li>
</ul>
<p><span class="math display">\[
\Sigma_k = \frac{\sum_{i=1}^n \gamma_{ik} (x_i - \mu_k)(x_i - \mu_k)^T}{\sum_{i=1}^n \gamma_{ik}}
\]</span></p>
<ul>
<li><strong>Répéter</strong></li>
</ul>
<p>Répéter les étapes <strong>E</strong> et <strong>M</strong> jusqu’à convergence, c’est-à-dire jusqu’à ce que la variation de la log-vraisemblance soit très faible ou qu’un nombre maximal d’itérations soit atteint.</p>
<ul>
<li><strong>Résumé</strong></li>
</ul>
<table class="table">
<colgroup>
<col style="width: 21%">
<col style="width: 78%">
</colgroup>
<thead>
<tr class="header">
<th>Étape</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Initialisation</td>
<td>Fixer <span class="math inline">\(\pi_k, \mu_k, \Sigma_k\)</span> pour <span class="math inline">\(k=1,\ldots,K\)</span></td>
</tr>
<tr class="even">
<td>E-step</td>
<td>Calculer les responsabilités <span class="math inline">\(\gamma_{ik}\)</span></td>
</tr>
<tr class="odd">
<td>M-step</td>
<td>Mettre à jour <span class="math inline">\(\pi_k, \mu_k, \Sigma_k\)</span></td>
</tr>
<tr class="even">
<td>Répéter</td>
<td>Jusqu’à convergence</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>   TransactionAmount  ...  DaysBetweenThisTransactionAndTheLastOne
0              14.09  ...                                    573.0
1             376.24  ...                                    496.0
2             126.29  ...                                    483.0
3             184.50  ...                                    549.0
4              13.45  ...                                    385.0

[5 rows x 5 columns]</code></pre>
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nous disposons des variables suivantes : le montant de la transaction, l’âge du client, la durée de la transaction, le solde du compte, ainsi que le nombre de jours écoulés depuis la dernière transaction.</p>
<p>Afin d’appliquer un modèle de mélange gaussien (GMM) à ces données, il est nécessaire de choisir un nombre optimal de composantes. En pratique, ce choix repose souvent sur des critères d’information tels que le <strong>Critère d’Information d’Akaike (AIC)</strong> ou le <strong>Critère d’Information Bayésien (BIC)</strong>. Plus ces critères sont faibles, meilleur est le modèle. Toutefois, il convient de rester vigilant face au risque de <strong>surapprentissage</strong> : un modèle trop complexe (avec trop de composantes) peut s’ajuster parfaitement aux données d’apprentissage mais perdre en capacité de généralisation.</p>
<p>Dans le cadre de l’apprentissage <strong>non supervisé</strong>, l’évaluation du modèle est plus délicate, car nous ne disposons pas de labels permettant de valider la qualité de la segmentation. Dans certains cas, un petit échantillon d’exemples étiquetés comme anomalies est disponible, ce qui permet une évaluation ciblée du modèle entraîné. Mais dans notre situation, aucune étiquette n’est fournie, ce qui rend l’évaluation entièrement dépendante de critères internes tels que l’<strong>AIC</strong> (Akaike Information Criterion) et le <strong>BIC</strong> (Bayesian Information Criterion).</p>
<p>En complément, nous pouvons également calculer les <strong>log-vraisemblances complètes</strong> pour différents nombres de composantes, afin de visualiser la qualité d’ajustement du modèle. Enfin, une stratégie consiste à définir un <strong>seuil d’anomalie</strong> à partir de la distribution des log-vraisemblances : par exemple, en retenant le <strong>5e percentile</strong>, les observations les moins vraisemblables (c’est-à-dire situées dans les 5 % les plus faibles) seront considérées comme potentiellement anormales.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.mixture <span class="im">import</span> GaussianMixture</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Préparation des données</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(df_continuous)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Paramètres</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>n_components_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">6</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>aic, bic, log_lik <span class="op">=</span> [], [], []</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Entraînement et évaluation du modèle</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> n_components_range:</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    gmm <span class="op">=</span> GaussianMixture(n_components<span class="op">=</span>n, random_state<span class="op">=</span>RANDOM_STATE)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    gmm.fit(X_scaled)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    aic.append(gmm.aic(X_scaled))</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    bic.append(gmm.bic(X_scaled))</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    log_lik.append(gmm.score(X_scaled) <span class="op">*</span> <span class="bu">len</span>(X_scaled))</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualisation</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>ig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a><span class="co"># AIC &amp; BIC</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(n_components_range, aic, label<span class="op">=</span><span class="st">'AIC'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].plot(n_components_range, bic, label<span class="op">=</span><span class="st">'BIC'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, marker<span class="op">=</span><span class="st">'s'</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"AIC &amp; BIC vs. nombre de composantes"</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_xlabel(<span class="st">"Nombre de composantes"</span>)</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_ylabel(<span class="st">"Score AIC/BIC"</span>)</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].legend()</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].grid(<span class="va">True</span>)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Log-vraisemblance</span></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].plot(n_components_range, log_lik, label<span class="op">=</span><span class="st">'Log-vraisemblance'</span>, color<span class="op">=</span><span class="st">'green'</span>, marker<span class="op">=</span><span class="st">'^'</span>)</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Log-vraisemblance vs. nombre de composantes"</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_xlabel(<span class="st">"Nombre de composantes"</span>)</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_ylabel(<span class="st">"Log-vraisemblance"</span>)</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].grid(<span class="va">True</span>)</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>plt.tight_layout(pad<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-selecting-components" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="components.png" style="width:95.0%;height:90.0%" class="figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Selecting the optimum number of components</figcaption>
</figure>
</div>
</div>
</div>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;On observe que plus le nombre de composantes augmente, plus les scores d’AIC et de BIC diminuent. Cependant, le <strong>BIC</strong> se stabilise à partir de la troisième composante, tandis que l’<strong>AIC</strong> continue de diminuer légèrement jusqu’à la cinquième. Cette divergence suggère qu’au-delà de trois composantes, le modèle pourrait être sujet à un <strong>surapprentissage</strong>.</p>
<p>Par ailleurs, l’évolution de la <strong>log-vraisemblance complète</strong> montre une augmentation nette entre une et trois composantes, suivie d’une progression beaucoup plus faible au-delà. Ces observations concordantes justifient le choix d’un modèle avec <strong>trois composantes</strong>, qui représente un bon compromis entre qualité d’ajustement et complexité.</p>
<div class="cell">
<div class="cell-output-display">
<style>#sk-container-id-1 {color: black;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>GaussianMixture(n_components=3, random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">GaussianMixture</label><div class="sk-toggleable__content"><pre>GaussianMixture(n_components=3, random_state=42)</pre></div></div></div></div></div>
</div>
</div>
<blockquote class="blockquote">
<p>Le 3ᵉ percentile est la valeur en dessous de laquelle se trouvent 3 % des observations dans un ensemble de données.</p>
</blockquote>
<blockquote class="blockquote">
<p>hue dans sns.pairplot — Qu’est-ce que c’est ? L’argument hue sert à colorer les points en fonction d’une variable catégorielle (généralement une étiquette ou un groupe). Cela permet de visualiser les différences entre groupes dans les nuages de points.</p>
</blockquote>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> copy <span class="im">import</span> deepcopy</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>df_continuous_with_anomalies_obs <span class="op">=</span> deepcopy(df_continuous)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>df_continuous_with_anomalies_obs[<span class="st">'Is anomaly'</span>] <span class="op">=</span> anomalies</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>sns.pairplot(df_continuous_with_anomalies_obs, hue<span class="op">=</span><span class="st">"Is anomaly"</span>, palette<span class="op">=</span>{<span class="va">False</span>: <span class="st">"blue"</span>, <span class="va">True</span>: <span class="st">"red"</span>}, corner<span class="op">=</span><span class="va">False</span>, height<span class="op">=</span><span class="fl">2.5</span>) <span class="co">#diag_kind="hist" ou kde pour la courbe</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#plt.suptitle('Anomalies detection with a Gaussian Mixture Model')</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-pairplot" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="pair-plot.png" style="width:95.0%;height:90.0%" class="figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Anomalies detection with a Gaussian Mixture Model</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="analyse-du-pairplot-des-anomalies-gmm" class="level1">
<h1>📊 Analyse du Pairplot des Anomalies (GMM)</h1>
<p>Ce graphique présente une <strong>visualisation croisée des variables continues</strong> du jeu de données, colorée selon l’appartenance à une anomalie détectée par un <strong>modèle de mélange gaussien (GMM)</strong>.</p>
<ul>
<li>🔵 <strong>Bleu</strong> : observations considérées comme <strong>normales</strong></li>
<li>🔴 <strong>Rouge</strong> : observations identifiées comme <strong>anomalies</strong></li>
</ul>
<section id="variables-analysées" class="level2">
<h2 class="anchored" data-anchor-id="variables-analysées">🎯 Variables analysées</h2>
<ul>
<li><code>CustomerAge</code> (Âge du client)</li>
<li><code>TransactionAmount</code> (Montant de la transaction)</li>
<li><code>TransactionDuration</code> (Durée de la transaction)</li>
<li><code>AccountBalance</code> (Solde du compte)</li>
<li><code>DaysBetweenThisTransactionAndTheLastOne</code> (Jours entre deux transactions)</li>
</ul>
</section>
<section id="lecture-du-graphique" class="level2">
<h2 class="anchored" data-anchor-id="lecture-du-graphique">Lecture du graphique</h2>
<ul>
<li>La <strong>diagonale</strong> contient les <strong>distributions marginales</strong> estimées de chaque variable :
<ul>
<li>En <strong>bleu</strong> : la densité des observations normales</li>
<li>En <strong>rouge</strong> : la densité des anomalies (souvent plus discrète car peu nombreuses)</li>
</ul></li>
<li>Les <strong>graphiques hors-diagonale</strong> sont des nuages de points croisant deux variables à la fois :
<ul>
<li>Les <strong>points rouges</strong> se situent souvent dans des zones de <strong>faible densité bleue</strong>, indiquant leur caractère atypique dans l’espace multivarié.</li>
</ul></li>
</ul>
<blockquote class="blockquote">
<p>💡 <strong>Remarque</strong> : Un point rouge mélangé à du bleu ne signifie pas une erreur du modèle, mais une <strong>anomalie faible</strong>, difficile à séparer par les seules combinaisons bivariées. L’analyse multidimensionnelle du GMM est ici essentielle.</p>
</blockquote>
<hr>
</section>
<section id="interprétation-variable-par-variable" class="level2">
<h2 class="anchored" data-anchor-id="interprétation-variable-par-variable">Interprétation variable par variable</h2>
<ul>
<li><p><strong>1. <code>TransactionAmount</code> (Montant de la transaction)</strong></p>
<ul>
<li><p><strong>Distribution</strong> : Asymétrique à droite (valeurs élevées peu fréquentes).</p></li>
<li><p><strong>Anomalies</strong> :</p>
<ul>
<li>Montants <strong>très élevés (&gt; 1 000)</strong> souvent identifiés comme atypiques.</li>
</ul></li>
<li><p><strong>Hypothèse</strong> : Retraits importants ou virements massifs peuvent signaler des comportements inhabituels (fraude, opération exceptionnelle).</p></li>
</ul></li>
<li><p><strong>2. <code>CustomerAge</code> (Age du client)</strong></p>
<ul>
<li><p><strong>Distribution</strong> : Potentiellement bimodale (ex. : jeunes adultes et seniors).</p></li>
<li><p><strong>Anomalies</strong> :</p>
<ul>
<li>Clients <strong>très jeunes (&lt; 18 ans)</strong> ou <strong>très âgés (&gt; 75 ans)</strong>.</li>
</ul></li>
<li><p><strong>Hypothèse</strong> : Ces tranches sont minoritaires et peuvent être liées à des profils atypiques ou vulnérables.</p></li>
</ul></li>
<li><p><strong>3. <code>TransactionDuration</code> (Durée de la transaction)</strong></p>
<ul>
<li><p><strong>Distribution</strong> : Relativement étalée.</p></li>
<li><p><strong>Anomalies</strong> :</p>
<ul>
<li><strong>Très longues (&gt; 250 s)</strong> ou <strong>très courtes (&lt; 5 s)</strong>.</li>
</ul></li>
<li><p><strong>Hypothèse</strong> : Durées extrêmes peuvent refléter des problèmes techniques ou des manipulations suspectes.</p></li>
</ul></li>
<li><p><strong>4. <code>AccountBalance</code> (Solde du compte)</strong></p>
<ul>
<li><p><strong>Distribution</strong> : Concentrée vers les faibles soldes, avec une queue à droite.</p></li>
<li><p><strong>Anomalies</strong> :</p>
<ul>
<li><strong>Soldes très élevés (&gt; 12 000)</strong> ou <strong>très bas (≈ 0)</strong>.</li>
</ul></li>
<li><p><strong>Hypothèse</strong> : Les extrêmes financiers peuvent attirer l’attention en détection d’anomalies.</p></li>
</ul></li>
<li><p><strong>5. <code>DaysBetweenThisTransactionAndTheLastOne</code> (Jours entre deux transactions)</strong></p>
<ul>
<li><p><strong>Distribution</strong> : Dispersée.</p></li>
<li><p><strong>Anomalies</strong> :</p>
<ul>
<li>Périodes <strong>très courtes (&lt; 100 jours)</strong> ou <strong>très longues (&gt; 700 jours)</strong>.</li>
</ul></li>
<li><p><strong>Hypothèse</strong> : Des écarts extrêmes dans la fréquence peuvent indiquer une activité inhabituelle.</p></li>
</ul></li>
</ul>
<hr>
</section>
<section id="interactions-clés-entre-variables" class="level2">
<h2 class="anchored" data-anchor-id="interactions-clés-entre-variables">Interactions clés entre variables</h2>
<ul>
<li><p><strong><code>TransactionAmount</code> × <code>AccountBalance</code></strong></p>
<ul>
<li><p><strong>Zone à risque</strong> : Montants et soldes simultanément élevés.</p></li>
<li><p><strong>Interprétation</strong> : Le retrait de sommes importantes depuis un compte bien rempli peut correspondre à un comportement rare ou à surveiller.</p></li>
</ul></li>
<li><p><strong><code>TransactionAmount</code> × <code>TransactionDuration</code></strong></p>
<ul>
<li><p>Anomalies dans les cas de <strong>montants élevés + durées longues</strong>.</p></li>
<li><p><strong>Interprétation</strong> : Transactions longues et coûteuses peuvent signaler un traitement manuel, un bug ou une tentative malveillante.</p></li>
</ul></li>
<li><p><strong><code>CustomerAge</code> × Autres variables</strong></p>
<ul>
<li>Moins de patterns nets, mais les <strong>jeunes ou très âgés</strong> combinés à <strong>des comportements extrêmes</strong> (ex. : gros montant ou délai long) ressortent souvent comme anomalies.</li>
</ul></li>
</ul>
<hr>
</section>
<section id="cas-particulier-visible-dans-le-coin-bas-gauche" class="level2">
<h2 class="anchored" data-anchor-id="cas-particulier-visible-dans-le-coin-bas-gauche">Cas particulier visible dans le coin bas-gauche</h2>
<p>On observe que des <strong>transactions nulles ou très faibles (<code>TransactionAmount</code> ≈ 0)</strong> mais avec une <strong>durée de traitement très longue (<code>TransactionDuration</code> &gt; 250 s)</strong> sont fréquemment classées comme anomalies.</p>
<blockquote class="blockquote">
<p>🧩 Cela peut correspondre à une attente anormale sans transaction effective – ce qui peut indiquer une erreur technique, une fraude ou une activité suspecte.</p>
</blockquote>
<hr>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Le modèle <code>GMM</code> a permis de mettre en évidence des <strong>observations atypiques</strong>, définies comme ayant une <strong>faible probabilité d’appartenance</strong> à l’un des groupes dominants dans l’espace des variables continues.</p>
<ul>
<li><p><strong>Les anomalies détectées reflètent :</strong></p></li>
<li><p>Des <strong>valeurs extrêmes univariées</strong></p></li>
<li><p>Des <strong>combinaisons de comportements rares</strong>, parfois imperceptibles dans les projections bivariées</p></li>
<li><p><strong>Utilité :</strong></p></li>
<li><p>Surveillance des fraudes</p></li>
<li><p>Ajustement des règles de sécurité</p></li>
<li><p>Compréhension des profils inhabituels</p></li>
</ul>
<blockquote class="blockquote">
<p>🔬 <strong>Limite</strong> : Cette analyse repose uniquement sur des variables numériques continues. Intégrer des variables catégorielles ou discrètes (ex. : type de transaction, canal utilisé) permettrait d’affiner la détection.</p>
</blockquote>
</section>
<section id="annexes" class="level2">
<h2 class="anchored" data-anchor-id="annexes">Annexes</h2>
<blockquote class="blockquote">
<p><strong><code>Histogramme :</code></strong></p>
</blockquote>
<pre><code>|        ▆
|        ▆    ▆
|    ▆   ▆    ▆   ▆
|▆   ▆   ▆▆  ▆▆▆ ▆▆
+--------------------------&gt; valeur</code></pre>
<blockquote class="blockquote">
<p><strong><code>KDE (courbe lissée) :</code></strong></p>
</blockquote>
<pre><code>          /\
         /  \     /\
        /    \   /  \
_______/      \_/    \_____</code></pre>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-Bishop2006" class="csl-entry" role="listitem">
Bishop, Christopher M. 2006. <em>Pattern Recognition and Machine Learning</em>. Springer.
</div>
<div id="ref-Bolton2002" class="csl-entry" role="listitem">
Bolton, Richard J., and David J. Hand. 2002. <span>“Statistical Fraud Detection: A Review.”</span> <em>Statistical Science</em> 17 (3): 235–55.
</div>
<div id="ref-Chalapathy2019" class="csl-entry" role="listitem">
Chalapathy, Raghavendra, and Sanjay Chawla. 2019. <span>“Deep Learning for Anomaly Detection: A Survey.”</span> <em>arXiv Preprint arXiv:1901.03407</em>.
</div>
<div id="ref-Hastie2009" class="csl-entry" role="listitem">
Hastie, Trevor, Robert Tibshirani, and Jerome Friedman. 2009. <em>The Elements of Statistical Learning</em>. Springer.
</div>
<div id="ref-Ngai2011" class="csl-entry" role="listitem">
Ngai, Eric W. T., Yong Hu, Y. H. Wong, Yijun Chen, and Xin Sun. 2011. <span>“The Application of Data Mining Techniques in Financial Fraud Detection: A Classification Framework and an Academic Review of Literature.”</span> <em>Decision Support Systems</em> 50 (3): 559–69.
</div>
<div id="ref-Phua2010" class="csl-entry" role="listitem">
Phua, Clifton, Vincent Lee, Kate Smith, and Ross Gayler. 2010. <span>“A Comprehensive Survey of Data Mining-Based Fraud Detection Research.”</span> In <em>Artificial Intelligence Review</em>, 34:1–14. 2.
</div>
<div id="ref-Schwarz1978" class="csl-entry" role="listitem">
Schwarz, Gideon. 1978. <span>“Estimating the Dimension of a Model.”</span> <em>Annals of Statistics</em> 6 (2): 461–64.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>